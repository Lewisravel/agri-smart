{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "Prix de marché" %} - Agri Smart{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h2 class="mb-4">
            <i class="fas fa-dollar-sign text-warning"></i> 
            {% trans "Prix de marché des cultures" %}
        </h2>
    </div>
</div>

<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-header bg-warning text-dark">
                <h5 class="mb-0">
                    <i class="fas fa-chart-line"></i> {% trans "Évolution des prix" %}
                </h5>
            </div>
            <div class="card-body">
                <canvas id="priceChart" style="height: 400px;"></canvas>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-table"></i> {% trans "Prix par culture" %}
                </h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th>{% trans "Culture" %}</th>
                                <th>{% trans "Prix actuel (FCFA/kg)" %}</th>
                                <th>{% trans "Tendance" %}</th>
                                <th>{% trans "Région" %}</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for crop in crops %}
                            <tr>
                                <td>
                                    <i class="fas fa-seedling text-success"></i> 
                                    <strong>{{ crop.name_fr }}</strong>
                                </td>
                                <td>
                                    <span class="badge bg-primary fs-6">
                                        {% if crop.name_fr == "Maïs" %}500
                                        {% elif crop.name_fr == "Riz" %}650
                                        {% elif crop.name_fr == "Tomate" %}400
                                        {% elif crop.name_fr == "Manioc" %}300
                                        {% elif crop.name_fr == "Oignon" %}450
                                        {% elif crop.name_fr == "Arachide" %}550
                                        {% elif crop.name_fr == "Coton" %}350
                                        {% elif crop.name_fr == "Soja" %}600
                                        {% else %}450
                                        {% endif %} FCFA
                                    </span>
                                </td>
                                <td>
                                    {% if forloop.counter|divisibleby:2 %}
                                        <span class="text-success">
                                            <i class="fas fa-arrow-up"></i> +5%
                                        </span>
                                    {% else %}
                                        <span class="text-danger">
                                            <i class="fas fa-arrow-down"></i> -2%
                                        </span>
                                    {% endif %}
                                </td>
                                <td>
                                    <span class="badge bg-info">Centre</span>
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="4" class="text-center text-muted">
                                    {% trans "Aucune donnée de prix disponible pour le moment" %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-md-4 mb-3">
        <div class="card text-center">
            <div class="card-body">
                <i class="fas fa-chart-line fa-3x text-success mb-3"></i>
                <h5>{% trans "Prix en hausse" %}</h5>
                <p class="text-muted">4 cultures</p>
            </div>
        </div>
    </div>
    <div class="col-md-4 mb-3">
        <div class="card text-center">
            <div class="card-body">
                <i class="fas fa-chart-line fa-3x text-danger mb-3"></i>
                <h5>{% trans "Prix en baisse" %}</h5>
                <p class="text-muted">4 cultures</p>
            </div>
        </div>
    </div>
    <div class="col-md-4 mb-3">
        <div class="card text-center">
            <div class="card-body">
                <i class="fas fa-minus fa-3x text-warning mb-3"></i>
                <h5>{% trans "Prix stables" %}</h5>
                <p class="text-muted">0 cultures</p>
            </div>
        </div>
    </div>
</div>

<div class="row mt-4">
    <div class="col-12">
        <div class="alert alert-info">
            <i class="fas fa-info-circle"></i>
            <strong>{% trans "Note:" %}</strong>
            {% trans "Les prix sont mis à jour quotidiennement à partir des marchés locaux. Pour des informations plus détaillées, consultez votre marché régional." %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Graphique simple avec Chart.js
    const ctx = document.getElementById('priceChart');
    if (ctx) {
        const labels = ['Janvier', 'Février', 'Mars', 'Avril', 'Mai', 'Juin'];
        const data = {
            labels: labels,
            datasets: [
                {
                    label: 'Maïs',
                    data: [450, 470, 490, 480, 500, 520],
                    borderColor: 'rgb(255, 193, 7)',
                    backgroundColor: 'rgba(255, 193, 7, 0.1)',
                    tension: 0.3
                },
                {
                    label: 'Riz',
                    data: [650, 660, 680, 670, 690, 700],
                    borderColor: 'rgb(40, 167, 69)',
                    backgroundColor: 'rgba(40, 167, 69, 0.1)',
                    tension: 0.3
                },
                {
                    label: 'Tomate',
                    data: [350, 380, 360, 400, 420, 410],
                    borderColor: 'rgb(220, 53, 69)',
                    backgroundColor: 'rgba(220, 53, 69, 0.1)',
                    tension: 0.3
                }
            ]
        };

        try {
            new Chart(ctx, {
                type: 'line',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'Évolution des prix (FCFA/kg)'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            ticks: {
                                callback: function(value) {
                                    return value + ' FCFA';
                                }
                            }
                        }
                    }
                }
            });
        } catch (error) {
            console.error('Erreur lors de la création du graphique:', error);
            ctx.parentElement.innerHTML = '<p class="text-center text-muted p-5">Les graphiques seront disponibles prochainement</p>';
        }
    }
</script>
{% endblock %}